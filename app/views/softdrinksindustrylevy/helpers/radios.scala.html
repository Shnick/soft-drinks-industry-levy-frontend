@*
 * Copyright 2021 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@(pageKey: List[String], fieldKey: List[String], tell: Option[Html], radioOptions: Seq[String], existing: Option[String], errors: ErrorTree, messages: UniformMessages[Html], conditional: PartialFunction[String,Html] = PartialFunction.empty)

@keyDash=@{fieldKey.mkString("-")}
@keyDots=@{fieldKey.mkString(".")}

@surround(pageKey, fieldKey, tell, errors, messages) {
  <div class="form-group @if(errors.nonEmpty){form-group-error}">
    @radioOptions.zipWithIndex.map{ case (opt,num) =>
      <div class="multiple-choice govuk-radios__item" data-target="tg-@{keyDash}-@num">
        <input type="radio"             
          id="@{keyDash}-@num"
          name="@keyDots"
          value="@opt"
          @if(Some(opt) == existing){checked="checked"}

          @if(conditional.isDefinedAt(opt)) {
            aria-controls="tg-@{keyDash}-@num"
            @if(Some(opt) == existing){aria-expanded="true"} else {aria-expanded="false"}
          }
        />
        <label for="@{keyDash}-@num">@{messages.decompose({fieldKey :+ opt}.mkString("."))}</label>    
      </div>
    }
  </div>

  @radioOptions.zipWithIndex.map{ case (opt,num) =>
    @for(cond <- conditional.lift(opt)) {
      <div
        id="tg-@{keyDash}-@num"
        class="panel panel-border-narrow js-hidden"
        tabindex="-1"
        @if(Some(opt) == existing){aria-hidden="false"} else {aria-hidden="true"}>
        @cond
      </div>
    }
  }
}
