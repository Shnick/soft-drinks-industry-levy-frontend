@*
 * Copyright 2018 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.play.views.html.helpers._
@import views.html.softdrinksindustrylevy.helpers._
@import java.time.format.DateTimeFormatter
@import java.time.LocalDate
@import sdil.config.AppConfig

@import sdil.models.RegistrationFormData
@import sdil.models.backend.Site
@import sdil.models.Litreage
@import sdil.models.ContactDetails
@(
        formData: RegistrationFormData,
        packLarge: Option[Boolean],
        useCopacker: Option[Boolean],
        packageOwn: Option[Litreage],
        copacks: Option[Litreage],
        imports: Option[Litreage],
        isVoluntary: Boolean,
        startDate: LocalDate,
        warehouses: List[Site],
        packagingSites: List[Site],
        contactDetails: ContactDetails
)(implicit request: Request[_], messages: Messages, config: AppConfig)


    @declaration_table("declaration","your-business") {
        @declaration_details_table_row("declaration", "utr", None, formData.utr, '_colspan -> "2")

        @declaration_details_table_row("declaration", "business-name", None,
            formData.rosmData.organisationName, '_colspan -> "2")

        <tr>
            <td colspan = "2">@Messages("sdil.declaration.address")</td>
            <td>
                @formData.primaryAddress.nonEmptyLines.map { l =>
                  <div>@l</div>
                }
                <div>@Messages("sdil.declaration.uk")</div>
            </td>
        </tr>
    }

    @declaration_table("declaration","liable-activity") {
        @declaration_details_table_row(
            "declaration",
            "producer",
            Some(sdil.controllers.routes.RegistrationController.index("packLarge")),
            Messages(s"sdil.declaration.${packLarge.getOrElse(false)}"),
            '_colspan -> "2"
        )
        @if(packLarge.nonEmpty) {
            @declaration_details_table_row(
                "declaration",
                "isLargeProducer",
                Some(sdil.controllers.routes.RegistrationController.index("packLarge")),
                if(packLarge.getOrElse(false)) {
                    Messages("sdil.declaration.largeProducer")
                } else {
                    Messages("sdil.declaration.smallProducer")
                },
                '_colspan -> "2"
            )
        }

        @if(useCopacker.nonEmpty) {
            @declaration_details_table_row("declaration", "third-party",
                Some(sdil.controllers.routes.RegistrationController.index("useCopacker")),
                Messages(s"sdil.declaration.${useCopacker.getOrElse(false)}"), '_colspan -> "2")
        }

        @if(packageOwn.nonEmpty) {
            @declaration_details_table_row(
                "declaration",
                "packaging",
                Some(sdil.controllers.routes.RegistrationController.index("own-brands-packaged-at-own-sites")),
                Messages(s"sdil.declaration.${packageOwn.fold(false)(_ => true)}"),
                '_colspan -> "2"
            )

            @if(packageOwn.fold(false)(_ => true)) {
                @declaration_details_litres(
                    "declaration.package-own",
                    sdil.controllers.routes.RegistrationController.index("own-brands-packaged-at-own-sites"),
                    packageOwn.getOrElse(Litreage(0, 0))
                )
            }
        }


        @if(copacks.nonEmpty) {
            @declaration_details_table_row(
                "declaration",
                "customers",
                Some(sdil.controllers.routes.RegistrationController.index("packaged-as-a-contract-packer")),
                Messages(s"sdil.declaration.${copacks.fold(false)(_ => true)}"),
                '_colspan -> "2"
            )

            @if(copacks.fold(false)(_ => true)) {
                @declaration_details_litres(
                    "declaration.customerVol",
                    sdil.controllers.routes.RegistrationController.index("packaged-as-a-contract-packer"),
                    copacks.getOrElse(Litreage(0,0))
                )
            }
        }

        @if(imports.nonEmpty) {
            @declaration_details_table_row("declaration", "import",
                Some(sdil.controllers.routes.RegistrationController.index("brought-into-uk")),
                Messages(s"sdil.declaration.${imports.fold(false)(_ => true)}"), '_colspan -> "2")

            @if(imports.fold(false)(_ => true)) {
                @declaration_details_litres(
                    "declaration.import-volume",
                    sdil.controllers.routes.RegistrationController.index("brought-into-uk"),
                    imports.getOrElse(Litreage(0,0))
                )
            }
        }
    }

    @if(!isVoluntary) {
        @declaration_table("declaration", "liable-date") {
                @declaration_details_table_row("declaration", "date",
                    Some(sdil.controllers.routes.RegistrationController.index("regDate")),
                    startDate.format(DateTimeFormatter.ofPattern("dd/MM/yyyy")))
        }
    }

  @if(warehouses.nonEmpty || packagingSites.nonEmpty) {
        @declaration_table("declaration", "registered-sites") {
            @if(packagingSites.nonEmpty) {
                @declaration_details_table_row(
                    "declaration",
                    "production-sites",
                    Some(sdil.controllers.routes.RegistrationController.index("packSitesActivity")),
                    packagingSites.size.toString
                )
            }
            @if(warehouses.nonEmpty) {
                @declaration_details_table_row(
                    "declaration",
                    "warehouses",
                    Some(sdil.controllers.routes.RegistrationController.index("warehousesActivity")),
                    warehouses.size.toString
                )
            }
        }
    }

    @declaration_table("declaration", "contact-details") {
            @declaration_details_table_row("declaration", "name",
                Some(sdil.controllers.routes.RegistrationController.index("contactDetails")), contactDetails.fullName)
            @declaration_details_table_row("declaration", "position",
                Some(sdil.controllers.routes.RegistrationController.index("contactDetails")), contactDetails.position)
            @declaration_details_table_row("declaration", "phone-number",
                Some(sdil.controllers.routes.RegistrationController.index("contactDetails")), contactDetails.phoneNumber)
            @declaration_details_table_row("declaration", "email",
                Some(sdil.controllers.routes.RegistrationController.index("contactDetails")), contactDetails.email)
    }

    <br/>
    <p><a href="javascript:window.print()" class="print-link">@Messages("sdil.common.print")</a></p>

